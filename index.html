<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hell Kitty: Scythe of the Void</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { --hk-pink: #ff007f; --hk-soft: #ff99cc; --hk-dark: #0d0208; --hk-void: #000000; }
        * { box-sizing: border-box; image-rendering: pixelated; }
        body { background-color: var(--hk-void); color: #eee; font-family: 'Press Start 2P', cursive; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #game-container { position: relative; width: 1000px; height: 600px; border: 4px solid var(--hk-pink); overflow: hidden; box-shadow: 0 0 50px rgba(255, 0, 127, 0.4); }
        #ui-layer { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; width: calc(100% - 40px); }
        .stat-box { background: rgba(13, 2, 8, 0.8); border-left: 5px solid var(--hk-pink); padding: 8px; margin-bottom: 5px; }
        .bar { width: 180px; height: 8px; background: #222; margin-top: 5px; border: 1px solid #444; }
        .bar-fill { height: 100%; transition: width 0.2s; }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .btn { margin-top: 20px; background: var(--hk-pink); color: white; border: none; padding: 15px 30px; font-family: 'Press Start 2P'; cursor: pointer; font-size: 12px; }
        #game-container::after { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%); background-size: 100% 4px; z-index: 5; pointer-events: none; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui-layer">
            <div class="stat-box">
                <div style="font-size: 7px;">KITTY VITALITY</div>
                <div class="bar"><div id="hp-fill" class="bar-fill" style="background: var(--hk-pink); width: 100%;"></div></div>
            </div>
            <div class="stat-box">
                <div style="font-size: 7px;">DASH COOLDOWN</div>
                <div class="bar"><div id="dash-fill" class="bar-fill" style="background: #00ffff; width: 0%;"></div></div>
            </div>
            <div style="position: absolute; right: 0; top: 0; text-align: right;">
                <div style="font-size: 14px; color: var(--hk-pink);">LVL <span id="lvl-txt">1</span></div>
                <div style="font-size: 7px; margin-top: 5px; color: white;">ENEMY HP: <span id="enemy-hp">100</span>%</div>
            </div>
        </div>

        <div id="overlay">
            <h1 id="status-msg" style="color: white; font-size: 20px;">NIGHTMARE ENDED</h1>
            <button class="btn" onclick="location.reload()">TRY AGAIN</button>
        </div>

        <canvas id="gameCanvas"></canvas>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 1000; canvas.height = 600;

    const WORLD = { width: 3000, height: 2000 };
    let camera = { x: 0, y: 0 };
    let frame = 0;
    let gameState = "playing";

    // --- PLAYER ---
    let kitty = {
        x: 1500, y: 1000, w: 32, h: 40, speed: 5,
        hp: 100, glints: 0, lvl: 1,
        dashActive: false, dashTimer: 0, dashCD: 0,
        atkActive: false, atkTimer: 0, atkCD: 0,
        facing: 1, trail: []
    };

    // --- ENEMY ---
    let enemy = { x: 1200, y: 800, r: 45, hp: 100, speed: 2.8, shootCD: 0, knockbackX: 0, knockbackY: 0 };

    // --- MAP COMPLEXITY ---
    let stars = [], glints = [], bullets = [], pillars = [];
    for(let i=0; i<400; i++) stars.push({x: Math.random()*WORLD.width, y: Math.random()*WORLD.height, s: Math.random()*3});
    for(let i=0; i<20; i++) pillars.push({x: Math.random()*WORLD.width, y: Math.random()*WORLD.height, w: 60 + Math.random()*40, h: 100 + Math.random()*100});
    for(let i=0; i<15; i++) spawnGlint();

    function spawnGlint() { glints.push({ x: Math.random()*WORLD.width, y: Math.random()*WORLD.height, s: 10 }); }

    const keys = {};
    window.onkeydown = (e) => {
        keys[e.code] = true;
        if(e.code === 'Space' && kitty.dashCD === 0) startDash();
        if(e.code === 'KeyZ' && kitty.atkCD === 0) startAttack();
    };
    window.onkeyup = (e) => keys[e.code] = false;
    canvas.onmousedown = () => { if(kitty.atkCD === 0) startAttack(); };

    function startDash() { kitty.dashActive = true; kitty.dashTimer = 12; kitty.dashCD = 60; }
    function startAttack() { kitty.atkActive = true; kitty.atkTimer = 15; kitty.atkCD = 25; }

    function checkCollision(obj, target) {
        return obj.x < target.x + target.w && obj.x + (obj.w || 32) > target.x &&
               obj.y < target.y + target.h && obj.y + (obj.h || 40) > target.y;
    }

    function update() {
        if(gameState !== "playing") return;
        frame++;

        let mx = 0, my = 0;
        if (keys['ArrowLeft'] || keys['KeyA']) { mx = -1; kitty.facing = -1; }
        if (keys['ArrowRight'] || keys['KeyD']) { mx = 1; kitty.facing = 1; }
        if (keys['ArrowUp'] || keys['KeyW']) my = -1;
        if (keys['ArrowDown'] || keys['KeyS']) my = 1;

        let curSpeed = kitty.dashActive ? kitty.speed * 3 : kitty.speed;
        let nextX = kitty.x + mx * curSpeed;
        let nextY = kitty.y + my * curSpeed;

        // Pillar Collision
        let canMoveX = true, canMoveY = true;
        pillars.forEach(p => {
            if(checkCollision({x: nextX, y: kitty.y, w: kitty.w, h: kitty.h}, p)) canMoveX = false;
            if(checkCollision({x: kitty.x, y: nextY, w: kitty.w, h: kitty.h}, p)) canMoveY = false;
        });

        if(canMoveX) kitty.x = Math.max(0, Math.min(WORLD.width - kitty.w, nextX));
        if(canMoveY) kitty.y = Math.max(0, Math.min(WORLD.height - kitty.h, nextY));

        // Cooldowns
        if(kitty.dashTimer > 0) kitty.dashTimer--; else kitty.dashActive = false;
        if(kitty.dashCD > 0) kitty.dashCD--;
        if(kitty.atkTimer > 0) kitty.atkTimer--; else kitty.atkActive = false;
        if(kitty.atkCD > 0) kitty.atkCD--;

        // Attack Logic
        if(kitty.atkActive && kitty.atkTimer === 14) {
            let hitRange = 80;
            let dist = Math.hypot(kitty.x - enemy.x, kitty.y - enemy.y);
            if(dist < hitRange + enemy.r) {
                enemy.hp -= 20;
                enemy.knockbackX = (enemy.x - kitty.x) * 0.5;
                enemy.knockbackY = (enemy.y - kitty.y) * 0.5;
            }
        }

        // Enemy AI
        enemy.x += enemy.knockbackX; enemy.y += enemy.knockbackY;
        enemy.knockbackX *= 0.8; enemy.knockbackY *= 0.8;

        let angle = Math.atan2(kitty.y - enemy.y, kitty.x - enemy.x);
        enemy.x += Math.cos(angle) * enemy.speed;
        enemy.y += Math.sin(angle) * enemy.speed;

        if(frame % 70 === 0) bullets.push({x: enemy.x, y: enemy.y, vx: Math.cos(angle)*6, vy: Math.sin(angle)*6, life: 180});

        bullets.forEach((b, i) => {
            b.x += b.vx; b.y += b.vy; b.life--;
            if(!kitty.dashActive && Math.hypot(b.x - kitty.x, b.y - kitty.y) < 20) {
                kitty.hp -= 15; bullets.splice(i, 1);
            }
        });

        // Glints & Camera
        glints.forEach((g, i) => {
            if(Math.hypot(g.x - kitty.x, g.y - kitty.y) < 40) { glints.splice(i, 1); kitty.glints++; spawnGlint(); kitty.hp = Math.min(100, kitty.hp + 5); }
        });

        camera.x = kitty.x - canvas.width/2; camera.y = kitty.y - canvas.height/2;
        camera.x = Math.max(0, Math.min(camera.x, WORLD.width - canvas.width));
        camera.y = Math.max(0, Math.min(camera.y, WORLD.height - canvas.height));

        if(enemy.hp <= 0) { enemy.hp = 100; kitty.lvl++; enemy.speed += 0.5; }
        if(kitty.hp <= 0) { gameState = "over"; document.getElementById('overlay').style.display = "flex"; }
        updateUI();
    }

    function updateUI() {
        document.getElementById('hp-fill').style.width = kitty.hp + "%";
        document.getElementById('dash-fill').style.width = (kitty.dashCD / 60 * 100) + "%";
        document.getElementById('enemy-hp').innerText = enemy.hp;
        document.getElementById('lvl-txt').innerText = kitty.lvl;
    }

    function draw() {
        ctx.fillStyle = "#050005"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.save(); ctx.translate(-camera.x, -camera.y);

        stars.forEach(s => { ctx.fillStyle = "#333"; ctx.fillRect(s.x + (camera.x * 0.2), s.y + (camera.y * 0.2), s.s, s.s); });
        
        pillars.forEach(p => {
            ctx.fillStyle = "#150015"; ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.strokeStyle = varPink; ctx.strokeRect(p.x, p.y, p.w, p.h);
        });

        glints.forEach(g => {
            ctx.fillStyle = varPink; ctx.fillRect(g.x-5, g.y-5 + Math.sin(frame/10)*5, 12, 12);
        });

        // Kitty
        if(kitty.atkActive) {
            ctx.strokeStyle = varPink; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.arc(kitty.x + 16, kitty.y + 20, 70, 0, Math.PI*2); ctx.stroke();
        }
        ctx.fillStyle = "white"; ctx.fillRect(kitty.x, kitty.y, 32, 20);
        ctx.fillStyle = "black"; ctx.fillRect(kitty.x, kitty.y + 20, 32, 20);
        ctx.fillStyle = "#ee0000"; ctx.fillRect(kitty.x + (kitty.facing === 1 ? 20 : -5), kitty.y - 5, 15, 10);

        // Enemy
        ctx.fillStyle = "#110005"; ctx.beginPath(); ctx.arc(enemy.x, enemy.y, enemy.r, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = varPink; ctx.fillRect(enemy.x-15, enemy.y-10, 8, 8); ctx.fillRect(enemy.x+7, enemy.y-10, 8, 8);

        bullets.forEach(b => { ctx.fillStyle = varPink; ctx.beginPath(); ctx.arc(b.x, b.y, 6, 0, Math.PI*2); ctx.fill(); });

        ctx.restore();
    }

    const varPink = "#ff007f";
    function loop() { update(); draw(); requestAnimationFrame(loop); }
    loop();
</script>
</body>
</html>
